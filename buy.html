<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”¢å“è©³æƒ… | Eriju</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
    <script src="https://unpkg.com/@studio-freight/lenis@1.0.33/dist/lenis.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;700;900&family=Noto+Sans+TC:wght@300;400;700;900&display=swap');
        :root { --bg-light: #fdfdfd; }
        body { 
            background-color: var(--bg-light); color: #334155; 
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
            letter-spacing: -0.02em; padding-top: 80px;
        }

        /* çµ±ä¸€æ‡¸æµ®å°è¦½åˆ— */
        .floating-nav { 
            background: rgba(255, 255, 255, 0.4); backdrop-filter: blur(20px) saturate(160%);
            border: 1px solid rgba(0, 0, 0, 0.05); border-radius: 50px; margin-top: 20px;
            width: 90%; max-width: 1100px; left: 50%; transform: translateX(-50%);
            transition: all 0.6s cubic-bezier(0.16, 1, 0.3, 1); z-index: 1000;
        }

        .user-menu {
            position: absolute; top: 60px; right: 0; background: white; border-radius: 24px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1); border: 1px solid rgba(0,0,0,0.05);
            min-width: 220px; opacity: 0; visibility: hidden; transform: translateY(10px);
            transition: all 0.3s ease; z-index: 100; overflow: hidden;
        }
        #auth-section:hover .user-menu { opacity: 1; visibility: visible; transform: translateY(0); }
        #mobile-menu.active { opacity: 1 !important; pointer-events: auto !important; }

        /* è¼ªæ’­æ¨£å¼ */
        .slider-wrapper { position: relative; width: 100%; overflow: hidden; border-radius: 32px; background: white; border: 1px solid rgba(0,0,0,0.03); }
        .slider-container { display: flex; overflow-x: auto; scroll-snap-type: x mandatory; scroll-behavior: smooth; }
        .slider-container::-webkit-scrollbar { display: none; }
        .slide { flex: 0 0 100%; scroll-snap-align: start; display: flex; justify-content: center; align-items: center; min-height: 40vh; md:min-height: 50vh; padding: 20px; }
        .product-img { width: 100%; height: auto; max-height: 55vh; object-fit: contain; transition: transform 0.8s cubic-bezier(0.16, 1, 0.3, 1); }
        .slide:hover .product-img { transform: scale(1.05); }

        .nav-arrow {
            position: absolute; top: 50%; transform: translateY(-50%);
            width: 44px; height: 44px; background: white; border-radius: 15px;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; z-index: 20; border: 1px solid rgba(0,0,0,0.05);
            box-shadow: 0 10px 20px rgba(0,0,0,0.05); transition: 0.3s; color: #0f172a;
        }
        .nav-arrow:hover { scale: 1.1; background: #f8fafc; }

        .btn-buy { background: #0f172a; color: white; transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1); }
        .btn-buy:hover:not(:disabled) { transform: translateY(-4px); box-shadow: 0 20px 40px rgba(0,0,0,0.15); }

        /* è¦æ ¼é¢æ¿ */
        #spec-panel {
            position: fixed; bottom: 0; left: 0; width: 100%; background: white; border-radius: 40px 40px 0 0;
            transform: translateY(100%); transition: transform 0.5s cubic-bezier(0.16, 1, 0.3, 1);
            z-index: 1100; box-shadow: 0 -20px 60px rgba(0,0,0,0.15);
        }
        #spec-panel.active { transform: translateY(0); }
        .overlay { position: fixed; inset: 0; background: rgba(15, 23, 42, 0.4); backdrop-filter: blur(4px); opacity: 0; visibility: hidden; transition: 0.4s; z-index: 1050; }
        .overlay.active { opacity: 1; visibility: visible; }

        .dot-indicator { width: 6px; height: 6px; background: #e2e8f0; border-radius: 50%; margin: 0 4px; transition: 0.3s; }
        .dot-indicator.active { background: #0f172a; width: 20px; border-radius: 10px; }
    </style>
</head>
<body>

    <nav class="floating-nav fixed top-0 h-[70px] px-6 md:px-8 flex items-center justify-between">
        <a href="index.html" class="flex items-center group">
            <div class="w-10 h-10 rounded-xl overflow-hidden shadow-sm transition-all group-hover:rotate-6">
                <img src="photo/S__38223874.jpg" alt="Logo" class="w-full h-full object-cover">
            </div>
            <span class="ml-4 text-xl font-black tracking-tighter text-slate-900 uppercase">Eriju</span>
        </a>
        
        <div class="flex items-center gap-4 md:gap-8">
            <div class="hidden md:flex items-center gap-8 text-[13px] font-bold tracking-widest uppercase">
                <a href="catalog.html" class="text-slate-400 hover:text-slate-900 transition">é¸è³¼</a>
                <a href="about.html" class="text-slate-400 hover:text-slate-900 transition">é—œæ–¼</a>
            </div>

            <a href="cart.html" class="relative text-slate-900 text-xl p-2">
                ğŸ›’
                <span id="cart-dot" class="hidden absolute top-1 right-1 w-2.5 h-2.5 bg-slate-900 border-2 border-white rounded-full"></span>
            </a>

            <div id="auth-section" class="hidden md:block relative">
                <button onclick="handleQuickLogin()" class="text-[13px] font-bold text-slate-400 hover:text-slate-900 uppercase tracking-widest transition">ç™»å…¥</button>
            </div>

            <button onclick="toggleMobileMenu()" class="md:hidden text-slate-900 p-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                </svg>
            </button>
        </div>
    </nav>

    <div id="mobile-menu" class="fixed inset-0 bg-white/95 backdrop-blur-xl z-[2000] flex flex-col items-center justify-center gap-8 opacity-0 pointer-events-none transition-all duration-500">
        <button onclick="toggleMobileMenu()" class="absolute top-8 right-8 text-slate-400">âœ•</button>
        <a href="catalog.html" class="text-4xl font-black text-slate-900 uppercase">é¸è³¼ç³»åˆ—</a>
        <a href="cart.html" class="text-4xl font-black text-slate-900 uppercase">è³¼ç‰©è¢‹</a>
        <div id="auth-mobile-extra"></div>
    </div>

    <div id="loading" class="h-[70vh] flex items-center justify-center text-slate-300 font-bold tracking-[0.4em] animate-pulse uppercase text-xs">
        Crafting experience...
    </div>

    <main id="content" class="max-w-6xl mx-auto px-6 md:grid md:grid-cols-2 md:gap-20 py-12 md:py-24 hidden">
        <div class="image-box relative mb-12 md:mb-0">
            <div class="slider-wrapper">
                <button id="prev-btn" class="nav-arrow left-4 md:left-6" onclick="moveSlide(-1)">â®</button>
                <button id="next-btn" class="nav-arrow right-4 md:right-6" onclick="moveSlide(1)">â¯</button>
                <div class="slider-container" id="slider"></div>
            </div>
            <div class="flex justify-center mt-8" id="dots-container"></div>
        </div>

        <div class="flex flex-col justify-center space-y-10 reveal-content">
            <header>
                <span id="p-tag" class="text-orange-500 font-black text-[10px] tracking-[0.4em] uppercase block mb-4"></span>
                <h1 id="p-name" class="text-4xl md:text-6xl font-black tracking-tighter text-slate-900 leading-[1.1]"></h1>
                <p id="p-price" class="text-2xl md:text-3xl text-slate-400 font-bold tracking-tighter mt-6"></p>
                <p id="p-desc" class="text-slate-500 mt-8 leading-relaxed text-lg font-medium"></p>
            </header>

            <div class="p-8 bg-slate-50 rounded-[32px] border border-slate-100/50">
                <p id="p-detail-title" class="font-black text-[10px] uppercase tracking-[0.3em] mb-4 text-slate-400">å·¥è—ç´°ç¯€</p>
                <p id="p-detail" class="text-sm text-slate-500 leading-relaxed font-medium whitespace-pre-line"></p>
            </div>

            <button onclick="toggleSpec(true)" class="btn-buy w-full py-6 rounded-[24px] font-black text-lg uppercase tracking-widest shadow-xl">
                åŠ å…¥è³¼ç‰©è¢‹
            </button>
        </div>
    </main>

    <div class="overlay" onclick="toggleSpec(false)"></div>
    <div id="spec-panel">
        <div class="max-w-md mx-auto p-10">
            <div class="flex justify-between items-center mb-8">
                <h3 class="text-2xl font-black tracking-tight text-slate-900 uppercase">Confirm</h3>
                <button onclick="toggleSpec(false)" class="text-slate-300 hover:text-slate-900 transition">âœ•</button>
            </div>

            <div class="flex items-center justify-between mb-6 p-6 bg-slate-50 rounded-[24px]">
                <span class="font-bold text-slate-400 uppercase text-[10px] tracking-widest">æ•¸é‡</span>
                <div class="flex items-center gap-6">
                    <button onclick="changeQty(-1)" class="w-10 h-10 rounded-xl border border-slate-200 flex items-center justify-center font-black text-slate-900 hover:border-slate-900 transition">-</button>
                    <span id="buy-qty" class="text-2xl font-black w-8 text-center text-slate-900">1</span>
                    <button onclick="changeQty(1)" class="w-10 h-10 rounded-xl border border-slate-200 flex items-center justify-center font-black text-slate-900 hover:border-slate-900 transition">+</button>
                </div>
            </div>

            <div class="mb-8 p-6 bg-orange-50/50 rounded-[24px] border border-orange-100">
                <label class="flex items-start gap-4 cursor-pointer">
                    <input type="checkbox" id="terms-checkbox" class="mt-1 w-5 h-5 rounded border-slate-300 text-slate-900">
                    <div class="text-[11px] text-slate-500 leading-relaxed">
                        <span class="font-black text-slate-900 block mb-1 uppercase tracking-widest">å‰µä½œå°ˆæ¡ˆè²æ˜</span>
                        æˆ‘å·²äº†è§£æ­¤ç‚ºå€‹äººå‰µä½œå°ˆæ¡ˆä¹‹æ¸¬è©¦æ€§è²©å”®ï¼Œéå…¬å¸è¡Œè™Ÿã€‚ä¸‹å–®å³è¡¨ç¤ºç†è§£æœ¬å°ˆæ¡ˆä»åœ¨æ—©æœŸéšæ®µï¼Œå‡ºè²¨æ™‚é–“èˆ‡ç´°ç¯€å¯èƒ½ä¾å¯¦éš›ç‹€æ³èª¿æ•´ã€‚
                    </div>
                </label>
            </div>

            <div class="flex justify-between items-end mb-10 px-2">
                <span class="text-slate-400 font-bold uppercase text-[10px] tracking-widest pb-1">å°è¨ˆ</span>
                <span id="total-price" class="text-3xl font-black text-slate-900 tracking-tighter">NT$ 0</span>
            </div>

            <button id="confirm-btn" onclick="confirmAddToCart()" disabled class="w-full py-5 rounded-[22px] font-black uppercase tracking-widest transition-all duration-300 bg-slate-200 text-white cursor-not-allowed">
                ç¢ºèªä¸¦åŠ å…¥
            </button>
        </div>
    </div>

    <script>
        const _supabase = supabase.createClient('https://oikubhlwdbxrfhifqusn.supabase.co', 'sb_publishable_jwPs6RwbH4W4qg1ttjjZog_BcTN8VJy');
        const productId = new URLSearchParams(window.location.search).get('id');
        let currentProduct = null;
        let qty = 1;

        function toggleMobileMenu() {
            const menu = document.getElementById('mobile-menu');
            menu.classList.toggle('active');
            document.body.style.overflow = menu.classList.contains('active') ? 'hidden' : '';
        }

        function handleAuthUI() {
            const authSection = document.getElementById('auth-section');
            const authMobile = document.getElementById('auth-mobile-extra');
            _supabase.auth.onAuthStateChange((event, session) => {
                if (session?.user) {
                    const user = session.user;
                    const avatar = user.user_metadata.avatar_url || 'photo/S__38223874.jpg';
                    authSection.innerHTML = `
                        <div class="relative group">
                            <img src="${avatar}" class="w-9 h-9 rounded-xl ring-4 ring-white cursor-pointer shadow-sm hover:rotate-3 transition-transform">
                            <div class="user-menu p-3 text-left">
                                <div class="px-4 py-3 bg-slate-50 rounded-2xl mb-2">
                                    <p class="text-slate-900 text-[10px] font-black uppercase truncate">${user.user_metadata.full_name || 'Premium'}</p>
                                </div>
                                <a href="orders.html" class="block p-3 text-[11px] font-bold text-slate-600 hover:bg-slate-50 rounded-xl transition">ğŸ“¦ è¨‚å–®ç´€éŒ„</a>
                                <button onclick="_supabase.auth.signOut().then(()=>location.reload())" class="w-full text-left p-3 text-[11px] font-bold text-red-400 hover:bg-red-50 rounded-xl transition">ğŸšª ç™»å‡º</button>
                            </div>
                        </div>`;
                    authMobile.innerHTML = `<a href="orders.html" class="text-xl font-bold text-slate-400 uppercase">æˆ‘çš„è¨‚å–®</a>`;
                }
            });
        }

        async function handleQuickLogin() { await _supabase.auth.signInWithOAuth({ provider: 'google', options: { redirectTo: window.location.href } }); }

        async function init() {
            handleAuthUI();
            if (!productId) { document.getElementById('loading').innerText = "PRODUCT NOT FOUND"; return; }

            try {
                const { data: allProducts, error } = await _supabase.from('products').select('*');
                if (error) throw error;
                const p = allProducts.find(item => String(item.id) === String(productId));

                if (!p) { document.getElementById('loading').innerText = "ITEM NOT FOUND"; return; }

                currentProduct = p;
                document.getElementById('p-name').innerText = p.name;
                document.getElementById('p-price').innerText = `NT$ ${p.price.toLocaleString()}`;
                document.getElementById('total-price').innerText = `NT$ ${p.price.toLocaleString()}`;
                document.getElementById('p-desc').innerText = p.description || 'ç²¾å¿ƒæ‰‹å·¥æ‰“é€ ã€‚';
                document.getElementById('p-tag').innerText = p.tag || 'ERIC JUSTIN';
                document.getElementById('p-detail-title').innerText = p.detail_title || 'å·¥è—ç´°ç¯€';
                document.getElementById('p-detail').innerText = p.detail || 'æ¯ä¸€ä»¶ä½œå“çš†ç”±è·äººè¦ªè‡ªæ“åˆ€è£½ä½œã€‚';

                const imgList = [p.image_url, p.image_url2, p.image_url3].filter(u => u && u !== "null" && u !== "");
                if(imgList.length === 0) imgList.push('photo/S__38223874.jpg');
                
                const slider = document.getElementById('slider');
                const dots = document.getElementById('dots-container');
                slider.innerHTML = ''; dots.innerHTML = '';

                imgList.forEach((url, i) => {
                    slider.innerHTML += `<div class="slide"><img src="${url}" class="product-img"></div>`;
                    dots.innerHTML += `<div class="dot-indicator ${i===0?'active':''}"></div>`;
                });

                if(imgList.length <= 1) {
                    document.getElementById('prev-btn').classList.add('hidden');
                    document.getElementById('next-btn').classList.add('hidden');
                }

                document.getElementById('loading').style.display = 'none';
                document.getElementById('content').classList.remove('hidden');
                checkCartDot();

                // å…¥å ´å‹•ç•«
                gsap.from(".reveal-content", { y: 20, opacity: 0, duration: 1, ease: "power3.out" });

            } catch (err) {
                document.getElementById('loading').innerText = "CONNECTION ERROR";
            }
        }

        function moveSlide(dir) {
            const s = document.getElementById('slider');
            s.scrollBy({ left: dir * s.clientWidth, behavior: 'smooth' });
        }

        function toggleSpec(show) {
            document.getElementById('spec-panel').classList.toggle('active', show);
            document.querySelector('.overlay').classList.toggle('active', show);
        }

        document.getElementById('terms-checkbox').addEventListener('change', (e) => {
            const btn = document.getElementById('confirm-btn');
            btn.disabled = !e.target.checked;
            btn.classList.toggle('bg-slate-200', !e.target.checked);
            btn.classList.toggle('bg-slate-900', e.target.checked);
            btn.classList.toggle('cursor-not-allowed', !e.target.checked);
        });

        function changeQty(dir) {
            qty = Math.max(1, qty + dir);
            document.getElementById('buy-qty').innerText = qty;
            document.getElementById('total-price').innerText = `NT$ ${(currentProduct.price * qty).toLocaleString()}`;
        }

        function confirmAddToCart() {
            let cart = JSON.parse(localStorage.getItem('ej_cart') || '[]');
            const idx = cart.findIndex(item => item.id === currentProduct.id);
            if (idx > -1) cart[idx].qty += qty;
            else cart.push({ id: currentProduct.id, name: currentProduct.name, price: currentProduct.price, image: currentProduct.image_url, qty: qty });
            localStorage.setItem('ej_cart', JSON.stringify(cart));
            window.location.href = "cart.html";
        }

        function checkCartDot() {
            if (JSON.parse(localStorage.getItem('ej_cart') || '[]').length > 0) document.getElementById('cart-dot').classList.remove('hidden');
        }

        // æ»¾å‹•èˆ‡ Lenis åˆå§‹åŒ–
        window.addEventListener('DOMContentLoaded', () => {
            const lenis = new Lenis();
            function raf(time) { lenis.raf(time); requestAnimationFrame(raf); }
            requestAnimationFrame(raf);

            gsap.registerPlugin(ScrollTrigger);
            ScrollTrigger.create({
                start: "top -20",
                onEnter: () => gsap.to(".floating-nav", { marginTop: "10px", width: "95%", backgroundColor: "rgba(255,255,255,0.75)", duration: 0.6 }),
                onLeaveBack: () => gsap.to(".floating-nav", { marginTop: "20px", width: "90%", backgroundColor: "rgba(255,255,255,0.4)", duration: 0.6 })
            });
        });

        document.getElementById('slider').addEventListener('scroll', () => {
            const s = document.getElementById('slider');
            const index = Math.round(s.scrollLeft / s.clientWidth);
            document.querySelectorAll('.dot-indicator').forEach((dot, i) => dot.classList.toggle('active', i === index));
        });

        init();
    </script>
    <script>
        window.si = window.si || function () { (window.siq = window.siq || []).push(arguments); };
    </script>
    <script defer src="/_vercel/speed-insights/script.js"></script>
</body>
</html>